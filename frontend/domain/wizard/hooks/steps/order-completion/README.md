# Етап 5: Підтвердження та завершення з формуванням квитанції

## Опис етапу

П'ятий (фінальний) етап Order Wizard відповідає за:

- Перегляд повного замовлення з детальним розрахунком
- Юридичні аспекти та підпис клієнта
- Формування та друк квитанції
- Завершення процесу оформлення

## Хуки етапу

### `useOrderReview`

**Відповідальність:** Перегляд замовлення

- Формування повного підсумку замовлення
- Детальний розрахунок вартості для кожного предмета
- Відображення всіх застосованих модифікаторів
- Загальний розрахунок з урахуванням знижок та терміновості

### `useOrderLegalAspects`

**Відповідальність:** Юридичні аспекти

- Управління чекбоксом згоди з умовами
- Цифровий підпис клієнта на сенсорному екрані
- Валідація обов'язкових юридичних полів
- Збереження підпису

### `useReceiptGeneration`

**Відповідальність:** Формування квитанції

- Автоматичне генерування PDF квитанції
- Структурування всієї інформації замовлення
- Форматування детального розрахунку
- Додавання QR-коду для відстеження

### `useOrderFinalization`

**Відповідальність:** Завершення процесу

- Збереження замовлення в базі даних
- Друк квитанції у двох примірниках
- Відправлення PDF на email клієнта
- Підтвердження успішного завершення

### `useOrderCompletionStep` (композиційний)

**Відповідальність:** Координація всього етапу

- Об'єднання всіх підпроцесів завершення
- Управління послідовністю дій
- Обробка помилок та відкатів

## Структура квитанції

### Шапка

- Логотип та юридична інформація хімчистки
- Пункт прийому (філія)
- Прізвище та ініціали оператора

### Інформація про замовлення

- Номер квитанції та унікальна мітка
- Дати створення та видачі
- Інформація про клієнта

### Таблиця предметів

- Детальна інформація про кожен предмет
- Розгорнутий розрахунок ціни з модифікаторами
- Забруднення та дефекти

### Фінансова інформація

- Вартість до знижок
- Застосовані знижки та надбавки
- Загальна вартість та залишок до сплати

### Юридична інформація

- Умови надання послуг
- Підписи та печатки

## Опції видачі квитанції

- Автоматичний друк після завершення
- Друк у двох примірниках
- Можливість повторного друку
- Відправлення PDF на email

## Інтеграція з доменом

- **Zustand Store:** `finalOrder`, `receiptData`, `legalConsent`
- **Навігація:** `useWizardNavigation` для завершення
- **Валідація:** Zod схеми для фінальної валідації
- **API:** `OrderAdapter`, `ReceiptAdapter`, `EmailAdapter`
- **Сервіси:** `ReceiptGenerationService`, `OrderFinalizationService`
