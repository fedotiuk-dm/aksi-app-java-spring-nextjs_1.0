# План покращення проекту AKSI

## Вступ

Для подальшого вдосконалення проекту "Хімчистка AKSI", ми розробили комплексний план дій, розділений на етапи. Цей план базується на результатах CPD (Copy-Paste Detector) аналізу, який виявив ряд дублювання коду в проекті. Усунення цього дублювання не лише покращить структуру проекту, але й зробить його більш підтримуваним, зменшить ризики помилок і спростить подальшу розробку.

## Попередні досягнення

До цього моменту ми вже успішно виконали рефакторинг декількох ключових компонентів:

1. **AuthService** - Видалено дублікати в методах автентифікації
2. **PriceModifierCalculationServiceImpl** - Винесено повторюваний код у допоміжні методи
3. **BranchLocation DTO** - Створено базовий клас для запитів
4. **Client DTO** - Створено базовий клас для запитів
5. **OrderMapper** - Винесено дублюючі маппінги в спільний метод
6. **GlobalExceptionHandler** - Створено універсальний метод для обробки винятків
7. **AbstractItemIssueService** - Перенесено спільну логіку з дочірніх класів у батьківський

## Поточні виклики

На основі нового звіту CPD, ми виявили такі області, які потребують уваги:

1. **Контролери з дублюванням логіки**
2. **Сервіси з повторюваними фрагментами коду**
3. **Повтори в маппінгу і DTO класах**
4. **Дублікати в обробці помилок**

## План подальших поліпшень

### Фаза 1: Удосконалення сервісного рівня

#### 1.1. PriceRecommendationServiceImpl

- **Проблема**: 10 рядків дубльованого коду між методами (лінії 56 та 78)
- **Рішення**: Створити допоміжний метод для спільної логіки формування рекомендацій
- **Підхід**:
  - Винести спільний код в окремий приватний метод
  - Змінити існуючі методи для виклику нового методу

#### 1.2. ModifierRecommendationServiceImpl

- **Проблема**: 11 рядків дубльованого коду між методами (лінії 159 та 204) + 9 рядків (лінії 146 та 236)
- **Рішення**: Винести повторювані блоки в окремі методи
- **Підхід**:
  - Виділити частини для фільтрації та обробки модифікаторів
  - Створити службові методи для усунення дублювання

#### 1.3. OrderRequirementsServiceImpl та PaymentServiceImpl

- **Проблема**: 16 рядків дубльованого коду
- **Рішення**: Створити спільну утилітну функцію або шаблонний клас
- **Підхід**:
  - Проаналізувати спільні шаблони в обох сервісах
  - Винести логіку в спільний сервіс або утилітний клас

### Фаза 2: Покращення контролерів

#### 2.1. BranchLocationController

- **Проблема**: Дублювання в методах (лінії 68-82, 98-115, 70-134, 84-134)
- **Рішення**: Реорганізувати структуру методів
- **Підхід**:
  - Винести повторювані частини в приватні методи
  - Застосувати шаблон DTO для уніфікації відповідей

#### 2.2. OrderController

- **Проблема**: Численні дублікати в методах (4-9 рядків у різних місцях)
- **Рішення**: Створити шаблонні методи для обробки типових сценаріїв
- **Підхід**:
  - Виявити типові патерни в методах контролера
  - Створити базові допоміжні методи для стандартних CRUD операцій

#### 2.3. PriceModifierController та PriceCalculationController

- **Проблема**: 14 рядків дубльованого коду між методами, загальні патерни в API
- **Рішення**: Використати шаблонний підхід для організації API
- **Підхід**:
  - Створити базовий інтерфейс або абстрактний клас для стандартних операцій
  - Реалізувати специфічну логіку через наслідування або композицію

### Фаза 3: Рефакторинг служб для замовлень

#### 3.1. OrderServiceImpl

- **Проблема**: Масштабні дублікати в методах (11, 8, 9 рядків у різних блоках)
- **Рішення**: Повна реструктуризація сервісу з використанням шаблонів проектування
- **Підхід**:
  - Виділити логіку обробки замовлень у окремі компоненти
  - Використати патерн Стратегія для варіативної поведінки
  - Застосувати композицію для складних операцій

#### 3.2. OrderItemPhotoServiceImpl

- **Проблема**: Дублювання в методах обробки фото
- **Рішення**: Створити спеціалізований фото-обробник
- **Підхід**:
  - Винести код обробки фото у окремий клас
  - Використати ін'єкцію залежностей для модульності

### Фаза 4: Удосконалення інфраструктури безпеки

#### 4.1. SecurityConfig

- **Проблема**: Дублювання в конфігурації безпеки (лінії 60-70, 65-83)
- **Рішення**: Реорганізувати конфігурацію з використанням композиції
- **Підхід**:
  - Створити фабрики для типових налаштувань безпеки
  - Використати builder-патерн для конфігурації

#### 4.2. JwtUtils

- **Проблема**: Повторюваний код в обробці токенів
- **Рішення**: Спростити структуру JWT утиліт
- **Підхід**:
  - Узагальнити методи для роботи з різними типами токенів
  - Створити єдині шаблони валідації

### Фаза 5: Розширені можливості покращення коду

#### 5.1. Введення кешування

- **Мета**: Підвищення продуктивності для часто використовуваних даних
- **Рішення**:
  - Впровадити кешування для довідників та цін у PriceListService
  - Додати кешування результатів обчислень у PriceCalculationService

#### 5.2. Асинхронна обробка

- **Мета**: Підвищення відгуку системи для тривалих операцій
- **Рішення**:
  - Впровадити асинхронну обробку для генерації PDF
  - Додати події для розділення обробки замовлень

#### 5.3. Оптимізація запитів до бази даних

- **Мета**: Зменшення навантаження на базу даних
- **Рішення**:
  - Проаналізувати та оптимізувати N+1 запити
  - Покращити стратегії завантаження (lazy/eager)

## Технічні критерії успіху

При виконанні усіх етапів плану, ми очікуємо такі результати:

1. **Зменшення дублікації коду на 90%+** - підтверджується новим звітом CPD
2. **Покращення загальної структури проекту** - дотримання принципів SOLID
3. **Спрощення модульного тестування** - збільшення покриття тестами
4. **Підвищення продуктивності** - скорочення часу відгуку API

## Планування етапів реалізації

### Графік роботи

1. **Фаза 1 (Сервісний рівень)**: Тиждень 1-2

   - День 1-2: PriceRecommendationServiceImpl
   - День 3-4: ModifierRecommendationServiceImpl
   - День 5-7: OrderRequirementsServiceImpl та PaymentServiceImpl

2. **Фаза 2 (Контролери)**: Тиждень 3-4

   - День 1-3: BranchLocationController
   - День 4-7: OrderController та інші контролери

3. **Фаза 3 (Сервіси для замовлень)**: Тиждень 5-6

   - День 1-5: OrderServiceImpl
   - День 6-7: OrderItemPhotoServiceImpl

4. **Фаза 4 (Безпека)**: Тиждень 7

   - День 1-3: SecurityConfig
   - День 4-7: JwtUtils

5. **Фаза 5 (Розширення)**: Тиждень 8-10
   - День 1-7: Кешування
   - День 8-14: Асинхронна обробка
   - День 15-21: Оптимізація запитів до БД

## Висновок

Цей план представляє собою систематичний підхід до рефакторингу та вдосконалення проекту "Хімчистка AKSI". Поетапне виконання цих робіт не лише допоможе усунути наявне дублювання коду, але й закладе основу для більш надійної та масштабованої архітектури в майбутньому.

Кожний етап рефакторингу буде:

1. Задокументований з детальними змінами
2. Підкріплений модульними тестами
3. Перевірений на відсутність регресії
4. Завершений звітом про поліпшення

## Приорітет завдань

Завдання впорядковані за такими критеріями:

1. **Стратегічна цінність** - наскільки важливою є ця частина для розвитку проекту
2. **Складність рефакторингу** - оцінка ризиків та зусиль
3. **Залежності** - які компоненти потрібно рефакторити першими
4. **Ступінь дублювання** - кількість дублювання в цій області
