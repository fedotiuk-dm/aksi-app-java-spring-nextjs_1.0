databaseChangeLog:
  - changeSet:
      id: test-game-calculator-flow-v2
      author: system
      comment: Create single test game (EFT) with complete calculator flow data
      runOnChange: false

      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: games
        - tableExists:
            tableName: difficulty_levels
        - tableExists:
            tableName: service_types
        - tableExists:
            tableName: price_configurations
        - tableExists:
            tableName: game_modifiers
        - tableExists:
            tableName: game_modifier_service_types
        # Skip if EFT game already exists
        - sqlCheck:
            expectedResult: "0"
            sql: SELECT COUNT(*) FROM games WHERE code = 'EFT'

      changes:
        # ===== TEST GAME: EFT (Escape from Tarkov) =====
        - insert:
            tableName: games
            columns:
              - column:
                  name: id
                  valueComputed: gen_random_uuid()
              - column:
                  name: code
                  value: EFT
              - column:
                  name: name
                  value: Escape from Tarkov
              - column:
                  name: description
                  value: Realistic military tactical FPS with survival elements
              - column:
                  name: category
                  value: FPS
              - column:
                  name: active
                  valueBoolean: true
              - column:
                  name: sort_order
                  valueNumeric: 1
              - column:
                  name: created_at
                  valueComputed: now()
              - column:
                  name: updated_at
                  valueComputed: now()

        # ===== DIFFICULTY LEVELS =====
        - insert:
            tableName: difficulty_levels
            columns:
              - column:
                  name: id
                  valueComputed: gen_random_uuid()
              - column:
                  name: game_id
                  valueComputed: (SELECT id FROM games WHERE code = 'EFT')
              - column:
                  name: code
                  value: PMC
              - column:
                  name: name
                  value: PMC
              - column:
                  name: level_value
                  valueNumeric: 2
              - column:
                  name: active
                  valueBoolean: true
              - column:
                  name: sort_order
                  valueNumeric: 1
              - column:
                  name: created_at
                  valueComputed: now()
              - column:
                  name: updated_at
                  valueComputed: now()

        # ===== SERVICE TYPES =====
        - insert:
            tableName: service_types
            columns:
              - column:
                  name: id
                  valueComputed: gen_random_uuid()
              - column:
                  name: game_id
                  valueComputed: (SELECT id FROM games WHERE code = 'EFT')
              - column:
                  name: code
                  value: BOOSTING
              - column:
                  name: name
                  value: EFT Boosting
              - column:
                  name: description
                  value: Professional Escape from Tarkov boosting service
              - column:
                  name: active
                  valueBoolean: true
              - column:
                  name: sort_order
                  valueNumeric: 1
              - column:
                  name: created_at
                  valueComputed: now()
              - column:
                  name: updated_at
                  valueComputed: now()

        # ===== PRICE CONFIGURATIONS =====
        - insert:
            tableName: price_configurations
            columns:
              - column:
                  name: id
                  valueComputed: gen_random_uuid()
              - column:
                  name: game_id
                  valueComputed: (SELECT id FROM games WHERE code = 'EFT')
              - column:
                  name: difficulty_level_id
                  valueComputed: (SELECT dl.id FROM difficulty_levels dl JOIN games g ON dl.game_id = g.id WHERE dl.code = 'PMC' AND g.code = 'EFT')
              - column:
                  name: service_type_id
                  valueComputed: (SELECT st.id FROM service_types st JOIN games g ON st.game_id = g.id WHERE st.code = 'BOOSTING' AND g.code = 'EFT')
              - column:
                  name: base_price
                  valueNumeric: 220000 # $2200.00 in cents
              - column:
                  name: price_per_level
                  valueNumeric: 5000 # $50.00 per level in cents
              - column:
                  name: calculation_formula
                  value: basePrice + (levelDifference * pricePerLevel)
              - column:
                  name: active
                  valueBoolean: true
              - column:
                  name: is_default
                  valueBoolean: true
              - column:
                  name: sort_order
                  valueNumeric: 1
              - column:
                  name: created_at
                  valueComputed: now()
              - column:
                  name: updated_at
                  valueComputed: now()

        # ===== GAME MODIFIERS =====
        # Base timing modifier
        - insert:
            tableName: game_modifiers
            columns:
              - column:
                  name: id
                  valueComputed: gen_random_uuid()
              - column:
                  name: code
                  value: RUSH_24H
              - column:
                  name: name
                  value: 24h Rush Order
              - column:
                  name: description
                  value: Complete order within 24 hours (double speed)
              - column:
                  name: modifier_type
                  value: TIMING
              - column:
                  name: operation_type
                  value: MULTIPLY
              - column:
                  name: modifier_value
                  valueNumeric: 200 # 200% increase
              - column:
                  name: game_code
                  value: "" # Game-agnostic
              - column:
                  name: sort_order
                  valueNumeric: 1
              - column:
                  name: icon
                  value: "âš¡"
              - column:
                  name: color
                  value: "#FF6B35"
              - column:
                  name: active
                  valueBoolean: true
              - column:
                  name: created_at
                  valueComputed: now()
              - column:
                  name: updated_at
                  valueComputed: now()

        # EFT specific modifier
        - insert:
            tableName: game_modifiers
            columns:
              - column:
                  name: id
                  valueComputed: gen_random_uuid()
              - column:
                  name: code
                  value: EFT_RAID_CARRY
              - column:
                  name: name
                  value: Raid Carry Service
              - column:
                  name: description
                  value: Full raid completion with maximum loot extraction
              - column:
                  name: modifier_type
                  value: SERVICE
              - column:
                  name: operation_type
                  value: ADD
              - column:
                  name: modifier_value
                  valueNumeric: 150000 # $1500.00 in cents
              - column:
                  name: game_code
                  value: EFT
              - column:
                  name: sort_order
                  valueNumeric: 2
              - column:
                  name: icon
                  value: "ðŸŽ’"
              - column:
                  name: color
                  value: "#4CAF50"
              - column:
                  name: active
                  valueBoolean: true
              - column:
                  name: created_at
                  valueComputed: now()
              - column:
                  name: updated_at
                  valueComputed: now()

        # ===== MODIFIER TO SERVICE TYPE LINKS =====
        # RUSH_24H -> BOOSTING
        - insert:
            tableName: game_modifier_service_types
            columns:
              - column:
                  name: game_modifier_id
                  valueComputed: (SELECT id FROM game_modifiers WHERE code = 'RUSH_24H' LIMIT 1)
              - column:
                  name: service_type_code
                  value: BOOSTING

        # EFT_RAID_CARRY -> BOOSTING
        - insert:
            tableName: game_modifier_service_types
            columns:
              - column:
                  name: game_modifier_id
                  valueComputed: (SELECT id FROM game_modifiers WHERE code = 'EFT_RAID_CARRY' LIMIT 1)
              - column:
                  name: service_type_code
                  value: BOOSTING
