databaseChangeLog:
  # Створення основної таблиці branches
  - changeSet:
      id: 001-create-branches-table
      author: system
      changes:
        - createTable:
            tableName: branches
            columns:
              # BaseEntity поля
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: uuid
                  type: UUID
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
              - column:
                  name: version
                  type: BIGINT
                  defaultValue: "0"

              # BranchEntity основні поля
              - column:
                  name: code
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: status
                  type: VARCHAR(20)
                  constraints:
                    nullable: false

              # Адресні поля
              - column:
                  name: country
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: region
                  type: VARCHAR(50)
              - column:
                  name: city
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: street
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: building_number
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: apartment_office
                  type: VARCHAR(20)
              - column:
                  name: postal_code
                  type: VARCHAR(10)
              - column:
                  name: district
                  type: VARCHAR(50)

              # Координати (embedded)
              - column:
                  name: latitude
                  type: DECIMAL(10,8)
                  constraints:
                    nullable: false
              - column:
                  name: longitude
                  type: DECIMAL(11,8)
                  constraints:
                    nullable: false
              - column:
                  name: map_url
                  type: VARCHAR(500)

              # Контактна інформація (embedded)
              - column:
                  name: phone
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: alternative_phone
                  type: VARCHAR(20)
              - column:
                  name: email
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: manager_name
                  type: VARCHAR(100)

              # Лічільник квитанцій
              - column:
                  name: receipt_counter
                  type: BIGINT
                  defaultValue: "0"
                  constraints:
                    nullable: false

  # Створення індексів для таблиці branches
  - changeSet:
      id: 002-create-branches-indexes
      author: system
      changes:
        - createIndex:
            indexName: idx_branch_uuid
            tableName: branches
            columns:
              - column:
                  name: uuid
        - createIndex:
            indexName: idx_branch_code
            tableName: branches
            columns:
              - column:
                  name: code
        - createIndex:
            indexName: idx_branch_status
            tableName: branches
            columns:
              - column:
                  name: status
        - createIndex:
            indexName: idx_branch_city
            tableName: branches
            columns:
              - column:
                  name: city
        - createIndex:
            indexName: idx_branch_location
            tableName: branches
            columns:
              - column:
                  name: latitude
              - column:
                  name: longitude
        - createIndex:
            indexName: idx_branch_name
            tableName: branches
            columns:
              - column:
                  name: name

  # Додавання check constraints для enum values
  - changeSet:
      id: 003-add-branch-constraints
      author: system
      changes:
        - sql:
            sql: >
              ALTER TABLE branches
              ADD CONSTRAINT chk_branch_status
              CHECK (status IN ('ACTIVE', 'INACTIVE', 'TEMPORARILY_CLOSED', 'UNDER_RENOVATION'));
        - sql:
            sql: >
              ALTER TABLE branches
              ADD CONSTRAINT chk_branch_coordinates_lat
              CHECK (latitude >= -90 AND latitude <= 90);
        - sql:
            sql: >
              ALTER TABLE branches
              ADD CONSTRAINT chk_branch_coordinates_lon
              CHECK (longitude >= -180 AND longitude <= 180);

  # Створення таблиці working_schedules
  - changeSet:
      id: 004-create-working-schedules-table
      author: system
      changes:
        - createTable:
            tableName: working_schedules
            columns:
              # BaseEntity поля
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: uuid
                  type: UUID
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
              - column:
                  name: version
                  type: BIGINT
                  defaultValue: "0"

              # WorkingScheduleEntity поля
              - column:
                  name: branch_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: timezone
                  type: VARCHAR(50)
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            baseTableName: working_schedules
            baseColumnNames: branch_id
            constraintName: fk_working_schedule_branch
            referencedTableName: branches
            referencedColumnNames: id
            onDelete: CASCADE

  # Створення індексів для working_schedules
  - changeSet:
      id: 005-create-working-schedules-indexes
      author: system
      changes:
        - createIndex:
            indexName: idx_working_schedule_uuid
            tableName: working_schedules
            columns:
              - column:
                  name: uuid
        - createIndex:
            indexName: idx_working_schedule_branch_id
            tableName: working_schedules
            columns:
              - column:
                  name: branch_id
        - createIndex:
            indexName: idx_working_schedule_timezone
            tableName: working_schedules
            columns:
              - column:
                  name: timezone

  # Створення таблиці working_days
  - changeSet:
      id: 006-create-working-days-table
      author: system
      changes:
        - createTable:
            tableName: working_days
            columns:
              # BaseEntity поля
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: uuid
                  type: UUID
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
              - column:
                  name: version
                  type: BIGINT
                  defaultValue: "0"

              # WorkingDayEntity поля
              - column:
                  name: working_schedule_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: day_of_week
                  type: VARCHAR(10)
                  constraints:
                    nullable: false
              - column:
                  name: is_working_day
                  type: BOOLEAN
                  defaultValue: "true"
                  constraints:
                    nullable: false
              - column:
                  name: open_time
                  type: TIME
              - column:
                  name: close_time
                  type: TIME
              - column:
                  name: lunch_break_start
                  type: TIME
              - column:
                  name: lunch_break_end
                  type: TIME
              - column:
                  name: notes
                  type: VARCHAR(500)

        - addForeignKeyConstraint:
            baseTableName: working_days
            baseColumnNames: working_schedule_id
            constraintName: fk_working_day_schedule
            referencedTableName: working_schedules
            referencedColumnNames: id
            onDelete: CASCADE

  # Створення індексів для working_days
  - changeSet:
      id: 007-create-working-days-indexes
      author: system
      changes:
        - createIndex:
            indexName: idx_working_day_uuid
            tableName: working_days
            columns:
              - column:
                  name: uuid
        - createIndex:
            indexName: idx_working_day_schedule_id
            tableName: working_days
            columns:
              - column:
                  name: working_schedule_id
        - createIndex:
            indexName: idx_working_day_day_of_week
            tableName: working_days
            columns:
              - column:
                  name: day_of_week
        - createIndex:
            indexName: idx_working_day_is_working
            tableName: working_days
            columns:
              - column:
                  name: is_working_day
        - createIndex:
            indexName: idx_working_day_hours
            tableName: working_days
            columns:
              - column:
                  name: open_time
              - column:
                  name: close_time

  # Додавання check constraints для working_days
  - changeSet:
      id: 008-add-working-days-constraints
      author: system
      changes:
        - sql:
            sql: >
              ALTER TABLE working_days
              ADD CONSTRAINT chk_working_day_day_of_week
              CHECK (day_of_week IN ('MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY', 'SUNDAY'));
        - sql:
            sql: >
              ALTER TABLE working_days
              ADD CONSTRAINT chk_working_day_times
              CHECK ((is_working_day = false) OR (open_time IS NOT NULL AND close_time IS NOT NULL));

  # Створення таблиці holidays
  - changeSet:
      id: 009-create-holidays-table
      author: system
      changes:
        - createTable:
            tableName: holidays
            columns:
              # BaseEntity поля
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: uuid
                  type: UUID
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
              - column:
                  name: version
                  type: BIGINT
                  defaultValue: "0"

              # HolidayEntity поля
              - column:
                  name: working_schedule_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: is_recurring
                  type: BOOLEAN
                  defaultValue: "false"
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: VARCHAR(500)

        - addForeignKeyConstraint:
            baseTableName: holidays
            baseColumnNames: working_schedule_id
            constraintName: fk_holiday_schedule
            referencedTableName: working_schedules
            referencedColumnNames: id
            onDelete: CASCADE

  # Створення індексів для holidays
  - changeSet:
      id: 010-create-holidays-indexes
      author: system
      changes:
        - createIndex:
            indexName: idx_holiday_uuid
            tableName: holidays
            columns:
              - column:
                  name: uuid
        - createIndex:
            indexName: idx_holiday_schedule_id
            tableName: holidays
            columns:
              - column:
                  name: working_schedule_id
        - createIndex:
            indexName: idx_holiday_date
            tableName: holidays
            columns:
              - column:
                  name: date
        - createIndex:
            indexName: idx_holiday_recurring
            tableName: holidays
            columns:
              - column:
                  name: is_recurring
        - createIndex:
            indexName: idx_holiday_name
            tableName: holidays
            columns:
              - column:
                  name: name

  # Додавання коментарів до таблиць та стовпців для документації
  - changeSet:
      id: 011-add-table-comments
      author: system
      changes:
        - sql:
            sql: >
              COMMENT ON TABLE branches IS 'Філії хімчистки з адресою, контактами та координатами';
        - sql:
            sql: >
              COMMENT ON COLUMN branches.code IS 'Унікальний код філії (наприклад, AKSI-01)';
        - sql:
            sql: >
              COMMENT ON COLUMN branches.status IS 'Статус філії: ACTIVE, INACTIVE, TEMPORARILY_CLOSED, UNDER_RENOVATION';
        - sql:
            sql: >
              COMMENT ON COLUMN branches.receipt_counter IS 'Лічільник для генерації номерів квитанцій';
        - sql:
            sql: >
              COMMENT ON TABLE working_schedules IS 'Графік роботи філій з часовим поясом';
        - sql:
            sql: >
              COMMENT ON TABLE working_days IS 'Робочі дні для кожного графіку роботи';
        - sql:
            sql: >
              COMMENT ON COLUMN working_days.day_of_week IS 'День тижня: MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY';
        - sql:
            sql: >
              COMMENT ON TABLE holidays IS 'Святкові дні для графіків роботи, можуть бути щорічними';
