databaseChangeLog:
  - changeSet:
      id: 002-add-refresh-token-columns
      author: system
      comment: "Додаємо відсутні колонки в таблицю refresh_tokens згідно з RefreshTokenEntity"
      changes:
        - addColumn:
            tableName: refresh_tokens
            columns:
              - column:
                  name: device_info
                  type: VARCHAR(500)
                  constraints:
                    nullable: true
                  remarks: "Інформація про пристрій користувача"
              - column:
                  name: ip_address
                  type: VARCHAR(45)
                  constraints:
                    nullable: true
                  remarks: "IP адреса користувача (IPv4/IPv6)"
              - column:
                  name: last_used_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
                  remarks: "Час останнього використання токену"

        # Видаляємо колонку invalidated_at, якої немає в Entity
        - dropColumn:
            tableName: refresh_tokens
            columnName: invalidated_at

        # Додаємо індекси для нових колонок
        - createIndex:
            indexName: idx_refresh_token_last_used
            tableName: refresh_tokens
            columns:
              - column:
                  name: last_used_at
            where: "last_used_at IS NOT NULL"

        - createIndex:
            indexName: idx_refresh_token_ip_address
            tableName: refresh_tokens
            columns:
              - column:
                  name: ip_address
            where: "ip_address IS NOT NULL"
