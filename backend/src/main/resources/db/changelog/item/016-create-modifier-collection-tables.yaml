databaseChangeLog:
  - changeSet:
      id: 016-create-modifier-applicable-categories-table
      author: system
      comment: "Створення таблиці для зв'язків модифікаторів з категоріями"
      preConditions:
        - onFail: MARK_RAN
        - not:
            - tableExists:
                tableName: modifier_applicable_categories
      changes:
        - createTable:
            tableName: modifier_applicable_categories
            columns:
              - column:
                  name: modifier_id
                  type: UUID
                  constraints:
                    nullable: false
                  remarks: "Ідентифікатор модифікатора"
              - column:
                  name: category_id
                  type: UUID
                  constraints:
                    nullable: false
                  remarks: "Ідентифікатор категорії"

        # Первинний ключ як композитний
        - addPrimaryKey:
            tableName: modifier_applicable_categories
            columnNames: modifier_id, category_id
            constraintName: pk_modifier_applicable_categories

        # Зовнішній ключ до price_modifiers
        - addForeignKeyConstraint:
            baseTableName: modifier_applicable_categories
            baseColumnNames: modifier_id
            referencedTableName: price_modifiers
            referencedColumnNames: id
            constraintName: fk_modifier_applicable_modifier
            onDelete: CASCADE

        # Індекс для швидкого пошуку категорій по модифікатору
        - createIndex:
            tableName: modifier_applicable_categories
            indexName: idx_modifier_applicable_modifier
            columns:
              - column:
                  name: modifier_id

        # Індекс для швидкого пошуку модифікаторів по категорії
        - createIndex:
            tableName: modifier_applicable_categories
            indexName: idx_modifier_applicable_category
            columns:
              - column:
                  name: category_id

  - changeSet:
      id: 016-create-service-category-materials-table
      author: system
      comment: "Створення таблиці для матеріалів категорій"
      preConditions:
        - onFail: MARK_RAN
        - not:
            - tableExists:
                tableName: service_category_materials
      changes:
        - createTable:
            tableName: service_category_materials
            columns:
              - column:
                  name: category_id
                  type: UUID
                  constraints:
                    nullable: false
                  remarks: "Ідентифікатор категорії"
              - column:
                  name: material_type
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                  remarks: "Тип матеріалу"

        # Первинний ключ як композитний
        - addPrimaryKey:
            tableName: service_category_materials
            columnNames: category_id, material_type
            constraintName: pk_service_category_materials

        # Зовнішній ключ до service_categories
        - addForeignKeyConstraint:
            baseTableName: service_category_materials
            baseColumnNames: category_id
            referencedTableName: service_categories
            referencedColumnNames: id
            constraintName: fk_category_materials_category
            onDelete: CASCADE

        # Індекс для швидкого пошуку матеріалів по категорії
        - createIndex:
            tableName: service_category_materials
            indexName: idx_category_materials_category
            columns:
              - column:
                  name: category_id

  - changeSet:
      id: 016-create-service-category-modifiers-table
      author: system
      comment: "Створення таблиці для модифікаторів категорій"
      preConditions:
        - onFail: MARK_RAN
        - not:
            - tableExists:
                tableName: service_category_modifiers
      changes:
        - createTable:
            tableName: service_category_modifiers
            columns:
              - column:
                  name: category_id
                  type: UUID
                  constraints:
                    nullable: false
                  remarks: "Ідентифікатор категорії"
              - column:
                  name: modifier_id
                  type: UUID
                  constraints:
                    nullable: false
                  remarks: "Ідентифікатор модифікатора"

        # Первинний ключ як композитний
        - addPrimaryKey:
            tableName: service_category_modifiers
            columnNames: category_id, modifier_id
            constraintName: pk_service_category_modifiers

        # Зовнішній ключ до service_categories
        - addForeignKeyConstraint:
            baseTableName: service_category_modifiers
            baseColumnNames: category_id
            referencedTableName: service_categories
            referencedColumnNames: id
            constraintName: fk_category_modifiers_category
            onDelete: CASCADE

        # Зовнішній ключ до price_modifiers
        - addForeignKeyConstraint:
            baseTableName: service_category_modifiers
            baseColumnNames: modifier_id
            referencedTableName: price_modifiers
            referencedColumnNames: id
            constraintName: fk_category_modifiers_modifier
            onDelete: CASCADE

        # Індекс для швидкого пошуку модифікаторів по категорії
        - createIndex:
            tableName: service_category_modifiers
            indexName: idx_category_modifiers_category
            columns:
              - column:
                  name: category_id

        # Індекс для швидкого пошуку категорій по модифікатору
        - createIndex:
            tableName: service_category_modifiers
            indexName: idx_category_modifiers_modifier
            columns:
              - column:
                  name: modifier_id
