databaseChangeLog:
  - changeSet:
      id: item-002-create-price-list-items-table
      author: system
      comment: Create price list items table for service pricing
      preConditions:
        - onFail: MARK_RAN
          not:
            tableExists:
              tableName: price_list_items
      changes:
        # Create price_list_items table
        - createTable:
            tableName: price_list_items
            columns:
              # Primary key
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
                  defaultValueComputed: gen_random_uuid()
                  remarks: "Primary key for price list item entity"

              # Foreign key to service categories
              - column:
                  name: category_code
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                  remarks: "Reference to service category code"

              # Business fields
              - column:
                  name: catalog_number
                  type: INTEGER
                  constraints:
                    nullable: false
                  remarks: "Catalog number within category"

              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                  remarks: "Item name in Ukrainian"

              - column:
                  name: unit_of_measure
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
                  remarks: "Unit of measure (PIECE, SQUARE_METER, etc.)"

              # Price fields (embedded PriceDetails)
              - column:
                  name: base_price
                  type: DECIMAL(10, 2)
                  constraints:
                    nullable: false
                  remarks: "Base price for standard color"

              - column:
                  name: price_black
                  type: DECIMAL(10, 2)
                  remarks: "Price for black items"

              - column:
                  name: price_color
                  type: DECIMAL(10, 2)
                  remarks: "Price for colored items"

              - column:
                  name: active
                  type: BOOLEAN
                  constraints:
                    nullable: false
                  defaultValue: "true"
                  remarks: "Whether item is active"

              # Audit fields
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
                  defaultValueComputed: now()
                  remarks: "Record creation timestamp"

              - column:
                  name: updated_at
                  type: TIMESTAMP
                  remarks: "Record last update timestamp"

              - column:
                  name: version
                  type: BIGINT
                  defaultValue: "0"
                  remarks: "Version for optimistic locking"

        # Create foreign key constraint
        - addForeignKeyConstraint:
            baseTableName: price_list_items
            baseColumnNames: category_code
            constraintName: fk_price_list_items_category
            referencedTableName: service_categories
            referencedColumnNames: code
            onDelete: RESTRICT
            onUpdate: CASCADE

        # Create unique constraint for category + catalog number
        - addUniqueConstraint:
            tableName: price_list_items
            columnNames: category_code, catalog_number
            constraintName: uk_price_list_category_catalog

        # Create indexes
        - createIndex:
            tableName: price_list_items
            indexName: idx_price_list_active
            columns:
              - column:
                  name: active

        - createIndex:
            tableName: price_list_items
            indexName: idx_price_list_category
            columns:
              - column:
                  name: category_code

      rollback:
        - dropTable:
            tableName: price_list_items