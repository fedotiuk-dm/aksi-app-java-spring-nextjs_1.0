databaseChangeLog:
  - changeSet:
      id: 008-insert-category-materials-from-csv
      author: system
      comment: "Завантаження зв'язків категорій з матеріалами з CSV файлу"
      preConditions:
        - onFail: MARK_RAN
        - sqlCheck:
            expectedResult: 0
            sql: "SELECT COUNT(*) FROM service_category_materials"
      changes:
        - sql:
            sql: |
              INSERT INTO service_category_materials (category_id, material_type)
              SELECT
                sc.id as category_id,
                cm.material_type
              FROM (
                VALUES
                  ('CLOTHING', 'COTTON'), ('CLOTHING', 'WOOL'), ('CLOTHING', 'SILK'), ('CLOTHING', 'SYNTHETIC'),
                  ('LAUNDRY', 'COTTON'), ('LAUNDRY', 'WOOL'), ('LAUNDRY', 'SILK'), ('LAUNDRY', 'SYNTHETIC'),
                  ('IRONING', 'COTTON'), ('IRONING', 'WOOL'), ('IRONING', 'SILK'), ('IRONING', 'SYNTHETIC'),
                  ('DYEING', 'COTTON'), ('DYEING', 'WOOL'), ('DYEING', 'SILK'), ('DYEING', 'SYNTHETIC'),
                  ('ADDITIONAL_SERVICES', 'COTTON'), ('ADDITIONAL_SERVICES', 'WOOL'), ('ADDITIONAL_SERVICES', 'SILK'), ('ADDITIONAL_SERVICES', 'SYNTHETIC'),
                  ('LEATHER', 'SMOOTH_LEATHER'), ('LEATHER', 'NUBUCK'), ('LEATHER', 'SPLIT_LEATHER'), ('LEATHER', 'SUEDE'),
                  ('PADDING', 'SMOOTH_LEATHER'), ('PADDING', 'NUBUCK'), ('PADDING', 'SPLIT_LEATHER'), ('PADDING', 'SUEDE'),
                  ('FUR', 'NATURAL_FUR'), ('FUR', 'ARTIFICIAL_FUR')
              ) AS cm(category_code, material_type)
              JOIN service_categories sc ON sc.code = cm.category_code
              WHERE NOT EXISTS (
                SELECT 1 FROM service_category_materials scm
                WHERE scm.category_id = sc.id AND scm.material_type = cm.material_type
              );

      rollback:
        - delete:
            tableName: service_category_materials
