databaseChangeLog:
  - changeSet:
      id: 013-add-is-active-column-nullable
      author: system
      comment: "Додавання колонки is_active як nullable спочатку"
      changes:
        - addColumn:
            tableName: service_categories
            columns:
              - column:
                  name: is_active
                  type: BOOLEAN
                  remarks: "Статус активності категорії"

  - changeSet:
      id: 013-update-is-active-default-values
      author: system
      comment: "Встановлення значень за замовчуванням для існуючих записів"
      changes:
        - sql:
            sql: "UPDATE service_categories SET is_active = TRUE WHERE is_active IS NULL;"

  - changeSet:
      id: 013-add-is-active-not-null-constraint
      author: system
      comment: "Додавання NOT NULL constraint для is_active"
      changes:
        - addNotNullConstraint:
            tableName: service_categories
            columnName: is_active
            columnDataType: BOOLEAN
            defaultNullValue: "TRUE"

  - changeSet:
      id: 013-add-standard-days-column-nullable
      author: system
      comment: "Додавання колонки standard_days як nullable спочатку"
      changes:
        - addColumn:
            tableName: service_categories
            columns:
              - column:
                  name: standard_days
                  type: INTEGER
                  remarks: "Стандартні дні виконання для категорії"

  - changeSet:
      id: 013-update-standard-days-default-values
      author: system
      comment: "Встановлення значень за замовчуванням для існуючих записів на основі категорій"
      changes:
        - sql:
            sql: |
              UPDATE service_categories
              SET standard_days = CASE
                WHEN code = 'IRONING' THEN 1
                WHEN code = 'LAUNDRY' THEN 2
                WHEN code = 'CLOTHING' THEN 3
                WHEN code = 'LEATHER' THEN 5
                WHEN code = 'PADDING' THEN 7
                WHEN code = 'FUR' THEN 10
                WHEN code = 'DYEING' THEN 14
                WHEN code = 'ADDITIONAL_SERVICES' THEN 3
                ELSE 3
              END
              WHERE standard_days IS NULL;

  - changeSet:
      id: 013-add-standard-days-not-null-constraint
      author: system
      comment: "Додавання NOT NULL constraint та check constraint для standard_days"
      changes:
        - addNotNullConstraint:
            tableName: service_categories
            columnName: standard_days
            columnDataType: INTEGER
            defaultNullValue: "3"
        - sql:
            sql: "ALTER TABLE service_categories ADD CONSTRAINT chk_standard_days CHECK (standard_days >= 1 AND standard_days <= 30);"

  - changeSet:
      id: 013-create-indexes
      author: system
      comment: "Створення індексів для нових колонок"
      changes:
        - createIndex:
            indexName: idx_service_category_active
            tableName: service_categories
            columns:
              - column:
                  name: is_active
        - createIndex:
            indexName: idx_service_category_standard_days
            tableName: service_categories
            columns:
              - column:
                  name: standard_days

      rollback:
        - dropIndex:
            indexName: idx_service_category_active
            tableName: service_categories
        - dropIndex:
            indexName: idx_service_category_standard_days
            tableName: service_categories
        - dropColumn:
            tableName: service_categories
            columnName: is_active
        - dropColumn:
            tableName: service_categories
            columnName: standard_days
