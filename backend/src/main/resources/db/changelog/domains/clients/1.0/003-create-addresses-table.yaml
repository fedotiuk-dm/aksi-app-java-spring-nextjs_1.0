databaseChangeLog:
  - changeSet:
      id: clients-1.0-003
      author: ai-assistant
      comment: Create addresses table and update clients
      preConditions:
        - onFail: MARK_RAN
          not:
            - tableExists:
                tableName: addresses
      changes:
        # Створення таблиці addresses
        - createTable:
            tableName: addresses
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: city
                  type: VARCHAR(100)
              - column:
                  name: street
                  type: VARCHAR(100)
              - column:
                  name: building
                  type: VARCHAR(50)
              - column:
                  name: apartment
                  type: VARCHAR(50)
              - column:
                  name: postal_code
                  type: VARCHAR(20)
              - column:
                  name: full_address
                  type: VARCHAR(500)

        # Додавання колонки address_id до таблиці clients
        - addColumn:
            tableName: clients
            columns:
              - column:
                  name: address_id
                  type: UUID
                  constraints:
                    foreignKeyName: fk_client_address
                    references: addresses(id)
                    nullable: true

        # Створення індексу для address_id
        - createIndex:
            tableName: clients
            indexName: idx_clients_address_id
            columns:
              - column:
                  name: address_id

  # Міграція даних з поля address до нової таблиці addresses
  # виконується окремим скриптом або через API після запуску програми
  - changeSet:
      id: clients-1.0-004
      author: ai-assistant
      comment: Remove deprecated address column (після міграції даних)
      changes:
        - dropColumn:
            tableName: clients
            columnName: address
            remarks: Поле видалено після переходу на структуровані адреси
