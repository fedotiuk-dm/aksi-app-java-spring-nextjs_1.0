databaseChangeLog:
  - changeSet:
      id: client-category-and-preferences
      author: cascade
      comment: Додавання категорії клієнта та переваг
      changes:
        # Додаємо категорію клієнта
        - addColumn:
            tableName: clients
            columns:
              - column:
                  name: category
                  type: varchar(20)
                  defaultValue: 'STANDARD'
                  constraints:
                    nullable: true
                  remarks: "Категорія клієнта (STANDARD, REGULAR, VIP, CORPORATE)"

        # Створюємо таблицю для переваг клієнта
        - createTable:
            tableName: client_preferences
            remarks: "Таблиця для зберігання переваг клієнтів"
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
                  remarks: "Унікальний ідентифікатор переваги"
              - column:
                  name: client_id
                  type: uuid
                  constraints:
                    nullable: false
                    foreignKeyName: fk_preference_client
                    references: clients(id)
                  remarks: "Ідентифікатор клієнта"
              - column:
                  name: preference_key
                  type: varchar(100)
                  constraints:
                    nullable: false
                  remarks: "Ключ переваги"
              - column:
                  name: preference_value
                  type: varchar(255)
                  remarks: "Значення переваги"
              - column:
                  name: created_at
                  type: timestamp
                  defaultValueComputed: "CURRENT_TIMESTAMP"
                  remarks: "Час створення запису"
              - column:
                  name: updated_at
                  type: timestamp
                  defaultValueComputed: "CURRENT_TIMESTAMP"
                  remarks: "Час останнього оновлення запису"

        # Додавання індексів
        - createIndex:
            tableName: client_preferences
            indexName: idx_client_preferences_client_id
            columns:
              - column:
                  name: client_id
        - createIndex:
            tableName: client_preferences
            indexName: idx_client_preferences_key
            columns:
              - column:
                  name: preference_key
