databaseChangeLog:
  - changeSet:
      id: 017-add-timestamps-to-order-items
      author: system
      comment: "Додавання колонок created_at та updated_at до таблиці order_items"
      changes:
        - addColumn:
            tableName: order_items
            columns:
              - column:
                  name: created_at
                  type: TIMESTAMP
                  remarks: "Час створення елемента замовлення"
                  constraints:
                    nullable: true
              - column:
                  name: updated_at
                  type: TIMESTAMP
                  remarks: "Час останнього оновлення елемента замовлення"
                  constraints:
                    nullable: true

        # Встановлюємо поточний час для існуючих записів
        - sql:
            sql: "UPDATE order_items SET created_at = NOW(), updated_at = NOW() WHERE created_at IS NULL"

        # Робимо колонки NOT NULL після заповнення
        - addNotNullConstraint:
            tableName: order_items
            columnName: created_at
            columnDataType: TIMESTAMP

        - addNotNullConstraint:
            tableName: order_items
            columnName: updated_at
            columnDataType: TIMESTAMP

      rollback:
        - dropColumn:
            tableName: order_items
            columnName: created_at
        - dropColumn:
            tableName: order_items
            columnName: updated_at
