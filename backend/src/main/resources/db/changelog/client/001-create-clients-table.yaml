databaseChangeLog:
  - changeSet:
      id: client-001-create-clients-table
      author: system
      comment: Create clients table for customer management
      changes:
        # Create clients table
        - createTable:
            tableName: clients
            columns:
              # Primary key
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
                  defaultValueComputed: gen_random_uuid()
                  remarks: "Primary key for client entity"

              # Basic client info
              - column:
                  name: first_name
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                  remarks: "Client's first name"

              - column:
                  name: last_name
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                  remarks: "Client's last name"

              - column:
                  name: phone
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
                    unique: true
                  remarks: "Unique phone number in international format"

              - column:
                  name: email
                  type: VARCHAR(100)
                  remarks: "Client's email address"

              # Address fields (embedded)
              - column:
                  name: street
                  type: VARCHAR(200)
                  remarks: "Street address"

              - column:
                  name: city
                  type: VARCHAR(100)
                  remarks: "City"

              - column:
                  name: region
                  type: VARCHAR(100)
                  remarks: "Region or state"

              - column:
                  name: postal_code
                  type: VARCHAR(5)
                  remarks: "Postal code (5 digits)"

              - column:
                  name: country
                  type: VARCHAR(100)
                  defaultValue: "Україна"
                  remarks: "Country name"

              # Source information
              - column:
                  name: source_type
                  type: VARCHAR(20)
                  remarks: "How client found us (INSTAGRAM, GOOGLE, REFERRAL, OTHER)"

              - column:
                  name: source_other
                  type: VARCHAR(100)
                  remarks: "Details if source_type is OTHER"

              # Preferences
              - column:
                  name: preferred_branch_id
                  type: UUID
                  remarks: "Reference to preferred branch"

              # Statistics (updated automatically)
              - column:
                  name: order_count
                  type: INTEGER
                  constraints:
                    nullable: false
                  defaultValueNumeric: "0"
                  remarks: "Total number of orders"

              - column:
                  name: total_spent
                  type: DECIMAL(10,2)
                  constraints:
                    nullable: false
                  defaultValueNumeric: "0.00"
                  remarks: "Total amount spent in UAH"

              - column:
                  name: last_order_date
                  type: DATE
                  remarks: "Date of last order"

              # Audit fields (managed by JPA @CreatedDate/@LastModifiedDate)
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
                  remarks: "Creation timestamp (managed by JPA)"

              - column:
                  name: updated_at
                  type: TIMESTAMP
                  remarks: "Last update timestamp (managed by JPA)"

              - column:
                  name: version
                  type: BIGINT
                  defaultValueNumeric: "0"
                  remarks: "Version for optimistic locking"

        # Create indexes
        - createIndex:
            tableName: clients
            indexName: idx_clients_phone
            unique: true
            columns:
              - column:
                  name: phone

        - createIndex:
            tableName: clients
            indexName: idx_clients_email
            columns:
              - column:
                  name: email

        - createIndex:
            tableName: clients
            indexName: idx_clients_name
            columns:
              - column:
                  name: last_name
              - column:
                  name: first_name

        - createIndex:
            tableName: clients
            indexName: idx_clients_search
            columns:
              - column:
                  name: first_name
              - column:
                  name: last_name
              - column:
                  name: phone
              - column:
                  name: email

        # Add foreign key constraint to branches table
        - addForeignKeyConstraint:
            baseTableName: clients
            baseColumnNames: preferred_branch_id
            referencedTableName: branches
            referencedColumnNames: id
            constraintName: fk_clients_preferred_branch