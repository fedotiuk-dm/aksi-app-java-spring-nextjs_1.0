databaseChangeLog:
  - changeSet:
      id: client-002-create-client-communication-methods-table
      author: system
      comment: Create table for client communication preferences
      changes:
        # Create client_communication_methods table
        - createTable:
            tableName: client_communication_methods
            columns:
              # Foreign key to clients
              - column:
                  name: client_id
                  type: UUID
                  constraints:
                    nullable: false
                  remarks: "Reference to the client"

              # Communication method
              - column:
                  name: method
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
                  remarks: "Communication method (PHONE, SMS, VIBER)"

        # Create composite primary key
        - addPrimaryKey:
            tableName: client_communication_methods
            columnNames: client_id, method
            constraintName: pk_client_communication_methods

        # Add foreign key constraint
        - addForeignKeyConstraint:
            baseTableName: client_communication_methods
            baseColumnNames: client_id
            referencedTableName: clients
            referencedColumnNames: id
            constraintName: fk_client_comm_methods_client
            onDelete: CASCADE

        # Create index for faster lookups
        - createIndex:
            tableName: client_communication_methods
            indexName: idx_client_comm_methods_client
            columns:
              - column:
                  name: client_id