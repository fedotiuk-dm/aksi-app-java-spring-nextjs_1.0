---
openapi: 3.0.4
info:
  title: Common Components
  version: 1.0.0

paths: {}

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: SESSION
      description: Session cookie for authentication (secure, HttpOnly, SameSite=Strict)
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token for authentication (recommended for API clients)

  # Common Parameters
  parameters:
    PageNumber:
      name: page
      in: query
      description: Page number (0-based)
      schema:
        type: integer
        minimum: 0
        default: 0

    PageSize:
      name: size
      in: query
      description: Page size (number of items per page)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    SortOrder:
      name: sortOrder
      in: query
      description: Sort direction
      schema:
        $ref: "#/components/schemas/SortOrder"
    SortBy:
      name: sortBy
      in: query
      description: Field to sort by (domain-specific). If not provided,
        server default is used
      schema:
        type: string
        pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
    CustomerId:
      name: customerId
      in: query
      description: Filter by customer ID
      schema:
        type: string
        format: uuid
    BranchId:
      name: branchId
      in: query
      description: Filter by branch ID
      schema:
        type: string
        format: uuid
    DateFrom:
      name: dateFrom
      in: query
      description: Filter by creation date from (UTC)
      schema:
        type: string
        format: date-time
    DateTo:
      name: dateTo
      in: query
      description: Filter by creation date to (UTC)
      schema:
        type: string
        format: date-time
    Search:
      name: search
      in: query
      description: Free text search
      schema:
        type: string
        pattern: "^[\\w\\s\\p{L}\\p{M}\\p{N}\\p{P}\\p{S}]{0,255}$"
    IdParam:
      name: id
      in: path
      description: Resource identifier
      required: true
      schema:
        type: string
        format: uuid

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Unauthorized access
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: Forbidden access
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Resource conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    TooManyRequests:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    PayloadTooLarge:
      description: Payload too large
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    NotAcceptable:
      description: Not Acceptable
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    default:
      description: Unexpected error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    # Common validation patterns and types
    UniqueName:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      minLength: 1
      maxLength: 255
      description: Unique name field (must be unique within entity type)
      x-unique: true
      x-validation: "@UniqueName"

    PhoneNumber:
      type: string
      pattern: "^.+?[0-9s\\-()]+$"
      minLength: 10
      maxLength: 20
      description: Phone number in international format
      example: "+380 (50) 123-45-67"

    Email:
      type: string
      format: email
      maxLength: 255
      description: Email address
      example: "user@example.com"

    # Shared schemas across domains
    ItemCharacteristics:
      type: object
      description: Item characteristics shared across cart, order, and pricing domains
      properties:
        material:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
          description: Material type (cotton, silk, wool, etc.)
          example: "cotton"
        color:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
          description: Item color (affects processing and pricing)
          example: "blue"
        filler:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
          description: Filler type for items with filling
          example: "down"
        fillerCondition:
          allOf:
            - $ref: "#/components/schemas/FillerCondition"
          description: Filler condition assessment
        wearLevel:
          allOf:
            - $ref: "#/components/schemas/WearLevel"
          description: Item wear level assessment
      additionalProperties: false

    # Centralized domain enums shared across APIs
    ServiceCategoryType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - CLOTHING
        - LAUNDRY
        - IRONING
        - LEATHER
        - PADDING
        - FUR
        - DYEING
        - ADDITIONAL_SERVICES
        - SHEEPSKIN
        - OTHER
      description: |
        Service category types from price list

    UnitOfMeasure:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - PIECE
        - KILOGRAM
        - PAIR
        - SQUARE_METER
      description: |
        Unit of measure

    PricingModifierType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum: [PERCENTAGE, FIXED, FORMULA, MULTIPLIER, DISCOUNT]
      description: Type of price modifier

    PricingOperationType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum: [ADD, SUBTRACT, MULTIPLY, DIVIDE]
      description: Operation type for applying modifiers
      x-enum-descriptions:
        - Add modifier value to base price
        - Subtract modifier value from base price
        - Multiply base price by modifier value
        - Divide base price by modifier value

    CalculationStatus:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum: [SUCCESS, FAILED, FALLBACK]
      description: Calculation result status
      x-enum-descriptions:
        - Calculation completed successfully
        - Calculation failed
        - Calculation used fallback method

    DiscountType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum: [NONE, EVERCARD, SOCIAL_MEDIA, MILITARY, OTHER]

    UrgencyType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum: [NORMAL, EXPRESS_48H, EXPRESS_24H]
      description: Order urgency levels

    # Order Management
    OrderStatus:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - PENDING
        - ACCEPTED
        - IN_PROGRESS
        - READY
        - COMPLETED
        - CANCELLED
      description: Order lifecycle status

    PaymentMethod:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - CASH
        - TERMINAL
        - BANK_TRANSFER
      description: Available payment methods

    # Item Characteristics
    FillerCondition:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - NORMAL
        - COMPRESSED
      description: Condition of item filler

    WearLevel:
      type: integer
      enum: [10, 30, 50, 75]
      description: Wear level percentage (allowed values)

    # Item Issues
    StainType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - GREASE
        - BLOOD
        - PROTEIN
        - WINE
        - COFFEE
        - GRASS
        - INK
        - COSMETICS
        - OTHER
      description: Types of stains on items

    DefectType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - WORN
        - TORN
        - MISSING_ACCESSORIES
        - DAMAGED_ACCESSORIES
        - OTHER
      description: Types of item defects

    RiskType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - COLOR_CHANGE
        - DEFORMATION
        - NO_WARRANTY
      description: Processing risk types

    # Photo Management
    PhotoType:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - GENERAL
        - DEFECT
        - STAIN
        - LABEL
      description: Types of item photos

    # User Management
    UserRole:
      type: string
      enum:
        - OPERATOR
        - MANAGER
        - ADMIN
        - CLEANER
        - DRIVER
      description: System user roles

    # Customer Management
    ContactPreference:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - PHONE
        - SMS
        - VIBER
      description: Customer contact preferences

    InfoSource:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum:
        - INSTAGRAM
        - GOOGLE
        - RECOMMENDATION
        - OTHER
      description: How customer found out about service

    # Sorting
    SortOrder:
      type: string
      pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      enum: [ASC, DESC]
      default: ASC
      description: Sort direction

    # Pagination (base) - use allOf in specific APIs to set data shape
    PaginatedResponse:
      type: object
      required:
        - data
        - totalElements
        - totalPages
        - size
        - number
        - numberOfElements
        - first
        - last
        - empty
      properties:
        data:
          type: array
          maxItems: 100
          items: {}
          description: Page content
        totalElements:
          type: integer
          format: int64
          description: Total number of elements
        totalPages:
          type: integer
          description: Total number of pages
        size:
          type: integer
          description: Page size
        number:
          type: integer
          description: Page number (0-based)
        numberOfElements:
          type: integer
          description: Number of elements in current page
        first:
          type: boolean
          description: Is first page
        last:
          type: boolean
          description: Is last page
        empty:
          type: boolean
          description: Is empty
      additionalProperties: false
    ErrorDetail:
      type: object
      required: [field, message]
      properties:
        field:
          type: string
          maxLength: 100
          pattern: "^[a-zA-Z_][a-zA-Z0-9_]*$"
          description: Field with error
          example: username
        message:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,500}$"
          description: Field error message
          example: "Invalid username format"
      additionalProperties: false

    ErrorResponse:
      type: object
      required: [timestamp, status, error, message, path]
      properties:
        timestamp:
          type: string
          format: date-time
        status:
          type: integer
        error:
          type: string
          maxLength: 100
          pattern: "^[A-Z][a-zA-Z0-9s]*$"
        message:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,1000}$"
        path:
          type: string
          maxLength: 500
          pattern: "^/[a-zA-Z0-9/_-]*$"
        errors:
          type: array
          maxItems: 20
          items:
            $ref: "#/components/schemas/ErrorDetail"
          nullable: true
      additionalProperties: false

    SuccessResponse:
      type: object
      required: [success, message]
      properties:
        success:
          type: boolean
          default: true
        message:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
          description: Success message
      additionalProperties: false

    ProblemDetails:
      type: object
      description: RFC 7807 Problem Details
      properties:
        type:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
        title:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
        status:
          type: integer
        detail:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
        instance:
          type: string
          pattern: "^[a-zA-Z0-9\\s.,!?-]{1,255}$"
      additionalProperties: false
