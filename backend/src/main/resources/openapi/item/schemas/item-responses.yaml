# Response схеми для Item домену

# Список категорій послуг
ServiceCategoryListResponse:
  type: object
  title: ServiceCategoryListResponse
  required:
    - categories
    - total
  properties:
    categories:
      type: array
      items:
        $ref: "#/ServiceCategory"
      description: Список категорій
    total:
      type: integer
      description: Загальна кількість категорій
      example: 11

# Категорія послуги
ServiceCategory:
  type: object
  title: ServiceCategory
  required:
    - code
    - name
    - standardDays
    - displayOrder
    - active
  properties:
    code:
      type: string
      description: Код категорії
      example: CLOTHING
    name:
      type: string
      description: Назва категорії
      example: Чистка одягу та текстилю
    standardDays:
      type: integer
      description: Стандартний термін виконання в днях
      example: 2
    displayOrder:
      type: integer
      description: Порядок відображення
      example: 1
    active:
      type: boolean
      description: Чи активна категорія
      example: true

ServiceCategoryResponse:
  type: object
  title: ServiceCategoryResponse
  required:
    - category
  properties:
    category:
      $ref: "#/ServiceCategory"
      description: Інформація про категорію

# Елемент прайс-листу
PriceListItem:
  type: object
  title: PriceListItem
  required:
    - id
    - categoryCode
    - catalogNumber
    - name
    - unitOfMeasure
    - basePrice
    - blackPrice
    - colorPrice
    - active
  properties:
    id:
      $ref: "../../common/schemas/base.yaml#/UUID"
    categoryCode:
      type: string
      description: Код категорії послуги
      example: CLOTHING
    catalogNumber:
      type: integer
      description: Каталоговий номер предмета
      example: 8
    name:
      type: string
      description: Назва предмета
      example: "Піджак, кітель"
    description:
      type: string
      description: Опис предмета
    unitOfMeasure:
      type: string
      description: Одиниця виміру
      example: PIECE
    basePrice:
      type: number
      format: double
      description: Базова ціна
      example: 480.0
    blackPrice:
      type: number
      format: double
      description: Ціна для чорних речей
      example: 480.0
    colorPrice:
      type: number
      format: double
      description: Ціна для кольорових речей
      example: 700.0
    active:
      type: boolean
      description: Чи активний предмет
      example: true
    displayOrder:
      type: integer
      description: Порядок відображення
      example: 1

# Відповідь зі списком елементів прайс-листу
PriceListItemListResponse:
  type: object
  title: PriceListItemListResponse
  required:
    - items
    - total
  properties:
    items:
      type: array
      items:
        $ref: "#/PriceListItem"
      description: Список елементів прайс-листу
    total:
      type: integer
      description: Загальна кількість елементів
      example: 150

PriceListItemResponse:
  type: object
  title: PriceListItemResponse
  required:
    - item
  properties:
    item:
      $ref: "#/PriceListItem"
      description: Інформація про елемент прайс-листу

PriceModifierResponse:
  type: object
  title: PriceModifierResponse
  required:
    - id
    - code
    - name
    - type
    - value
    - isActive
    - applicableTo
  properties:
    id:
      $ref: "../../common/schemas/base.yaml#/UUID"
    code:
      type: string
      description: Унікальний код модифікатора
      example: CHILDREN_ITEMS
    name:
      type: string
      description: Назва модифікатора
      example: Дитячі речі (до 30 розміру)
    type:
      $ref: "../../order/schemas/order-enums.yaml#/ModifierType"
    value:
      type: number
      format: double
      description: Значення модифікатора
      example: 30.0
    applicableTo:
      type: array
      items:
        type: string
      description: Коди категорій, до яких застосовується
      example: ["CLOTHING", "HOME_TEXTILE"]
    isActive:
      type: boolean
      description: Чи активний модифікатор
    description:
      type: string
      description: Опис модифікатора

PriceListResponse:
  type: object
  title: PriceListResponse
  required:
    - items
  properties:
    items:
      type: array
      items:
        $ref: "#/PriceListItemResponse"
      description: Список послуг з цінами

# Результат розрахунку вартості предмета
ItemCalculationResponse:
  type: object
  title: ItemCalculationResponse
  required:
    - priceListItemId
    - quantity
    - basePrice
    - finalPrice
    - appliedModifiers
    - calculationDetails
  properties:
    itemId:
      $ref: "../../common/schemas/base.yaml#/UUID"
      description: ID предмета замовлення (якщо збережено)
    priceListItemId:
      $ref: "../../common/schemas/base.yaml#/UUID"
    itemName:
      type: string
      description: Назва предмета
      example: "Піджак, кітель"
    categoryCode:
      type: string
      description: Код категорії послуги
      example: CLOTHING
    categoryName:
      type: string
      description: Назва категорії
      example: Чистка одягу та текстилю
    quantity:
      type: number
      format: double
      example: 1.0
    unitOfMeasure:
      $ref: "../../order/schemas/price-modifiers.yaml#/UnitType"
    color:
      $ref: "./item-enums.yaml#/ItemColor"
      description: Колір предмета
    basePrice:
      type: number
      format: double
      description: Базова ціна без модифікаторів
      example: 480.0
    colorPrice:
      type: number
      format: double
      description: Ціна з урахуванням кольору
      example: 480.0
    finalPrice:
      type: number
      format: double
      description: Фінальна ціна з усіма модифікаторами
      example: 624.0
    appliedModifiers:
      type: array
      items:
        $ref: "#/AppliedModifierResponse"
      description: Список застосованих модифікаторів
    calculationDetails:
      $ref: "#/CalculationDetailsResponse"
      description: Детальний розрахунок
    warnings:
      type: array
      items:
        type: string
      description: Попередження про розрахунок

# Попередній розрахунок (без збереження)
ItemPricePreviewResponse:
  type: object
  title: ItemPricePreviewResponse
  required:
    - basePrice
    - finalPrice
    - priceBreakdown
  properties:
    basePrice:
      type: number
      format: double
      example: 480.0
    colorPrice:
      type: number
      format: double
      example: 480.0
    finalPrice:
      type: number
      format: double
      example: 624.0
    priceBreakdown:
      type: array
      items:
        $ref: "#/PriceBreakdownItem"
      description: Покроковий розрахунок ціни
    warnings:
      type: array
      items:
        type: string
      description: Попередження про обмеження
      example: ["Знижка не застосовується до послуг прасування"]

# Підсумок розрахунку замовлення
OrderSummaryResponse:
  type: object
  title: OrderSummaryResponse
  required:
    - items
    - subtotal
    - totalAmount
    - urgencySurcharge
  properties:
    items:
      type: array
      items:
        $ref: "#/ItemCalculationResponse"
      description: Розрахунок для кожного предмета
    subtotal:
      type: number
      format: double
      description: Сума до знижок та надбавок
      example: 2400.0
    discount:
      $ref: "#/DiscountDetailsResponse"
      description: Деталі знижки
    urgencySurcharge:
      type: number
      format: double
      description: Надбавка за терміновість
      example: 1200.0
    totalAmount:
      type: number
      format: double
      description: Загальна сума до сплати
      example: 3240.0
    estimatedCompletionDate:
      type: string
      format: date-time
      description: Очікувана дата виконання
    summary:
      type: object
      properties:
        totalItems:
          type: integer
          description: Загальна кількість предметів
        totalQuantity:
          type: number
          format: double
          description: Загальна кількість (шт/кг)
        averageItemPrice:
          type: number
          format: double
          description: Середня ціна за предмет

# Інформація про фотографію
ItemPhotoResponse:
  type: object
  title: ItemPhotoResponse
  required:
    - id
    - orderItemId
    - fileName
    - fileType
    - fileSize
    - storagePath
  properties:
    id:
      $ref: "../../common/schemas/base.yaml#/UUID"
    orderItemId:
      $ref: "../../common/schemas/base.yaml#/UUID"
    fileName:
      type: string
      description: Оригінальна назва файлу
      example: "IMG_1234.jpg"
    fileType:
      type: string
      description: MIME тип файлу
      example: "image/jpeg"
    fileSize:
      type: integer
      format: int64
      description: Розмір файлу в байтах
      example: 1048576
    storagePath:
      type: string
      description: Шлях до файлу у сховищі
      example: "/photos/2025/01/123e4567-e89b.jpg"
    thumbnailPath:
      type: string
      description: Шлях до мініатюри
      example: "/photos/2025/01/123e4567-e89b_thumb.jpg"
    description:
      type: string
      description: Опис фотографії
      example: "Пляма на комірі"
    photoType:
      type: string
      enum:
        - BEFORE_CLEANING
        - STAIN
        - DAMAGE
        - GENERAL
      example: STAIN
    metadata:
      type: object
      additionalProperties:
        type: string
      description: Додаткові метадані
    uploadedBy:
      $ref: "../../common/schemas/base.yaml#/UUID"
      description: ID користувача, який завантажив
    downloadUrl:
      type: string
      description: URL для завантаження
      example: "/api/photos/123e4567-e89b-12d3-a456-426614174000/file"
    thumbnailUrl:
      type: string
      description: URL мініатюри
      example: "/api/photos/123e4567-e89b-12d3-a456-426614174000/file?thumbnail=true"
    createdAt:
      type: string
      format: date-time
      description: Дата створення
    updatedAt:
      type: string
      format: date-time
      description: Дата оновлення

# Відповідь на завантаження файлу фотографії
PhotoDownloadResponse:
  type: object
  title: PhotoDownloadResponse
  required:
    - url
    - contentType
    - size
  properties:
    url:
      type: string
      description: Прямий URL для завантаження
      example: "http://localhost:8080/api/photos/123e4567-e89b-12d3-a456-426614174000/file"
    contentType:
      type: string
      description: MIME тип файлу
      example: "image/jpeg"
    size:
      type: integer
      format: int64
      description: Розмір файлу в байтах
      example: 102400
    thumbnail:
      type: boolean
      description: Чи це мініатюра
      default: false
    fileName:
      type: string
      description: Назва файлу для завантаження
      example: "IMG_1234.jpg"

# Допоміжні схеми
AppliedModifierResponse:
  type: object
  title: AppliedModifierResponse
  required:
    - code
    - name
    - type
    - value
    - impact
  properties:
    code:
      type: string
      example: CHILDREN_ITEMS
    name:
      type: string
      example: "Дитячі речі (до 30 розміру)"
    type:
      $ref: "../../order/schemas/order-enums.yaml#/ModifierType"
    value:
      type: number
      format: double
      example: 30.0
    impact:
      type: number
      format: double
      description: Вплив на ціну в грошах
      example: -144.0
    priceAfter:
      type: number
      format: double
      description: Ціна після застосування
      example: 336.0

CalculationDetailsResponse:
  type: object
  title: CalculationDetailsResponse
  required:
    - steps
    - formula
  properties:
    steps:
      type: array
      items:
        $ref: "#/CalculationStepResponse"
      description: Кроки розрахунку
    formula:
      type: string
      description: Формула розрахунку
      example: "basePrice * (1 - 0.3) * (1 + 0.3)"
    jexlContext:
      type: object
      additionalProperties:
        type: object
      description: Контекст для JEXL формул

CalculationStepResponse:
  type: object
  title: CalculationStepResponse
  required:
    - step
    - description
    - priceAfter
  properties:
    step:
      type: integer
      example: 1
    description:
      type: string
      example: "Базова ціна"
    operation:
      type: string
      example: "base"
    value:
      type: number
      format: double
      example: 480.0
    priceAfter:
      type: number
      format: double
      example: 480.0

PriceBreakdownItem:
  type: object
  title: PriceBreakdownItem
  required:
    - label
    - amount
  properties:
    label:
      type: string
      example: "Базова ціна"
    amount:
      type: number
      format: double
      example: 480.0
    percentage:
      type: number
      format: double
      description: Відсоток зміни
      example: -30.0
    type:
      type: string
      enum:
        - BASE
        - MODIFIER
        - DISCOUNT
        - SURCHARGE
        - TOTAL
      example: BASE

DiscountDetailsResponse:
  type: object
  title: DiscountDetailsResponse
  required:
    - type
    - percentage
    - amount
  properties:
    type:
      type: string
      example: EVERCARD
    percentage:
      type: number
      format: double
      example: 10.0
    amount:
      type: number
      format: double
      description: Сума знижки
      example: 240.0
    applicableItems:
      type: integer
      description: Кількість предметів, до яких застосовується
      example: 8
    excludedItems:
      type: array
      items:
        type: string
      description: Предмети, виключені зі знижки
      example: ["Прасування", "Прання"]

# Модифікатор ціни 
PriceModifier:
  type: object
  title: PriceModifier
  required:
    - id
    - code
    - name
    - type
    - value
    - active
    - applicableCategories
  properties:
    id:
      $ref: "../../common/schemas/base.yaml#/UUID"
    code:
      type: string
      description: Код модифікатора
      example: CHILDREN_ITEMS
    name:
      type: string
      description: Назва модифікатора
      example: Дитячі речі (до 30 розміру)
    type:
      $ref: "../../order/schemas/order-enums.yaml#/ModifierType"
    value:
      type: number
      format: double
      description: Значення модифікатора
      example: 30.0
    active:
      type: boolean
      description: Чи активний модифікатор
      example: true
    applicableCategories:
      type: array
      items:
        type: string
      description: Категорії до яких застосовується
      example: ["CLOTHING", "HOME_TEXTILE"]
    description:
      type: string
      description: Опис модифікатора

# Список модифікаторів
PriceModifierListResponse:
  type: object
  title: PriceModifierListResponse
  required:
    - modifiers
    - total
  properties:
    modifiers:
      type: array
      items:
        $ref: "#/PriceModifier"
      description: Список модифікаторів
    total:
      type: integer
      description: Загальна кількість модифікаторів
      example: 15

# Фотографія предмета
ItemPhoto:
  type: object
  title: ItemPhoto
  required:
    - id
    - orderItemId
    - fileName
    - fileType
    - fileSize
    - uploadedAt
  properties:
    id:
      $ref: "../../common/schemas/base.yaml#/UUID"
    orderItemId:
      $ref: "../../common/schemas/base.yaml#/UUID"
    fileName:
      type: string
      description: Назва файлу
      example: IMG_1234.jpg
    fileType:
      type: string
      description: MIME тип файлу
      example: image/jpeg
    fileSize:
      type: integer
      format: int64
      description: Розмір файлу в байтах
      example: 1048576
    description:
      type: string
      description: Опис фотографії
      example: Пляма на комірі
    photoType:
      type: string
      enum:
        - BEFORE_CLEANING
        - STAIN
        - DAMAGE
        - GENERAL
      example: STAIN
    uploadedAt:
      type: string
      format: date-time
      description: Дата завантаження
    thumbnailUrl:
      type: string
      description: URL мініатюри
      example: /photos/2025/01/123e4567-e89b_thumb.jpg
    downloadUrl:
      type: string
      description: URL для завантаження
      example: /photos/2025/01/123e4567-e89b.jpg

# Список фотографій
ItemPhotoListResponse:
  type: object
  title: ItemPhotoListResponse
  required:
    - photos
    - total
  properties:
    photos:
      type: array
      items:
        $ref: "#/ItemPhoto"
      description: Список фотографій
    total:
      type: integer
      description: Загальна кількість фотографій
      example: 5

# Відповідь на завантаження фотографії
ItemPhotoUploadResponse:
  type: object
  title: ItemPhotoUploadResponse
  required:
    - photo
    - message
  properties:
    photo:
      $ref: "#/ItemPhoto"
      description: Інформація про завантажену фотографію
    message:
      type: string
      description: Повідомлення про результат
      example: Фотографію успішно завантажено

# Розрахунок модифікатора
ModifierCalculation:
  type: object
  title: ModifierCalculation
  required:
    - modifierCode
    - modifierName
    - type
    - value
    - calculatedAmount
  properties:
    modifierCode:
      type: string
      description: Код модифікатора
      example: CHILDREN_ITEMS
    modifierName:
      type: string
      description: Назва модифікатора
      example: Дитячі речі (до 30 розміру)
    type:
      $ref: "../../order/schemas/order-enums.yaml#/ModifierType"
    value:
      type: number
      format: double
      description: Значення модифікатора
      example: 30.0
    calculatedAmount:
      type: number
      format: double
      description: Розрахована сума впливу на ціну
      example: -144.0
    priceAfterModifier:
      type: number
      format: double
      description: Ціна після застосування модифікатора
      example: 336.0

