# Development Dockerfile for Spring Boot
FROM bellsoft/liberica-runtime-container:jdk-21-musl

WORKDIR /app

# Add tools needed for development
RUN apk add --no-cache \
    bash \
    curl \
    wget \
    openjdk21 \
    maven \
    shadow

# Set environment variables for development
ENV SPRING_PROFILES_ACTIVE=dev
ENV JAVA_OPTS="-Xms512m -Xmx1024m"
ENV MAVEN_OPTS="-Xmx1024m"
ENV PATH="/app:${PATH}"

# Expose ports: Spring Boot and Debug
EXPOSE 8080 5005

# Створюємо директорії з дозволами для запису
RUN mkdir -p /root/.m2 && chmod -R 777 /root/.m2
RUN mkdir -p /app/target && chmod -R 777 /app/target

# Для вирішення проблем з правами доступу запускаємо як root
# ВИДАЛЕНО jvmArguments з відладкою, тому що ці параметри встановлені в docker-compose.yml
CMD ["sh", "-c", "./mvnw spring-boot:run -Dspring-boot.run.profiles=dev"]
