<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.5</version>
        <relativePath/>
    </parent>

    <groupId>com.aksi</groupId>
    <artifactId>dry-cleaning-order-system</artifactId>
    <version>1.0.0</version>
    <name>AKSI Dry Cleaning Order System</name>
    <description>Dry cleaning order management system with DDD architecture and cookie-based authentication</description>

    <properties>
        <!-- Java Version -->
        <java.version>21</java.version>

        <!-- Spring Boot Parent Version (inherited) -->
        <spring-boot.version>3.5.5</spring-boot.version>

        <!-- Main Dependencies Versions -->
        <mapstruct.version>1.6.3</mapstruct.version>
        <itext.version>5.5.13.4</itext.version>
        <zxing.version>3.5.3</zxing.version>
        <springdoc.version>2.8.12</springdoc.version>
        <lombok.version>1.18.38</lombok.version>

        <!-- Security Dependencies Versions -->
        <commons-lang3.version>3.18.0</commons-lang3.version>
        <commons-compress.version>1.28.0</commons-compress.version>
        <pdfbox.version>3.0.5</pdfbox.version>
        <jjwt.version>0.12.6</jjwt.version>
        <jackson-databind.version>2.18.2</jackson-databind.version>
        <snakeyaml.version>2.5</snakeyaml.version>
        <testcontainers.version>1.21.3</testcontainers.version>
        <liquibase.version>4.33.0</liquibase.version>
        <liquibase-maven-plugin.version>4.30.0</liquibase-maven-plugin.version>

        <!-- Maven Plugins Versions -->
        <maven-pmd-plugin.version>3.27.0</maven-pmd-plugin.version>
        <openapi-generator-maven-plugin.version>7.15.0</openapi-generator-maven-plugin.version>
        <spotless-maven-plugin.version>2.46.1</spotless-maven-plugin.version>
        <google-java-format.version>1.27.0</google-java-format.version>
        <build-helper-maven-plugin.version>3.6.1</build-helper-maven-plugin.version>
        <maven-checkstyle-plugin.version>3.6.0</maven-checkstyle-plugin.version>
        <maven-versions-plugin.version>2.18.0</maven-versions-plugin.version>
        <checkstyle.version>10.26.1</checkstyle.version>

        <!-- Other Versions -->
        <passay.version>1.6.5</passay.version>
        <h2.version>2.3.232</h2.version>
        <jjwt-api.version>0.2.7</jjwt-api.version>
        <spring-security-test.version>3.5.0</spring-security-test.version>
    </properties>

    <dependencies>
        <!-- Security fixes for transitive dependencies -->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
            <version>${commons-lang3.version}</version>
        </dependency>

        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-compress</artifactId>
            <version>${commons-compress.version}</version>
        </dependency>

        <!-- Apache PDFBox for PDF generation -->
        <dependency>
            <groupId>org.apache.pdfbox</groupId>
            <artifactId>pdfbox</artifactId>
            <version>${pdfbox.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!-- Spring Boot Starters -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>

        <!-- Redis for Session Management -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.session</groupId>
            <artifactId>spring-session-data-redis</artifactId>
        </dependency>

        <!--        <dependency>-->
        <!--            <groupId>org.springframework.boot</groupId>-->
        <!--            <artifactId>spring-boot-starter-mail</artifactId>-->
        <!--        </dependency>-->

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>


        <!-- Database -->
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- Liquibase for DB migrations -->
        <dependency>
            <groupId>org.liquibase</groupId>
            <artifactId>liquibase-core</artifactId>
        </dependency>

        <!-- MapStruct for mapping -->
        <dependency>
            <groupId>org.mapstruct</groupId>
            <artifactId>mapstruct</artifactId>
            <version>${mapstruct.version}</version>
        </dependency>

        <dependency>
            <groupId>org.mapstruct</groupId>
            <artifactId>mapstruct-processor</artifactId>
            <version>${mapstruct.version}</version>
            <scope>provided</scope>
        </dependency>

        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <scope>provided</scope>
        </dependency>


        <!-- PDF Generation -->
        <dependency>
            <groupId>com.itextpdf</groupId>
            <artifactId>itextpdf</artifactId>
            <version>${itext.version}</version>
        </dependency>

        <!-- QR Code Generation -->
        <dependency>
            <groupId>com.google.zxing</groupId>
            <artifactId>core</artifactId>
            <version>${zxing.version}</version>
        </dependency>

        <dependency>
            <groupId>com.google.zxing</groupId>
            <artifactId>javase</artifactId>
            <version>${zxing.version}</version>
        </dependency>

        <!-- OpenAPI Documentation -->
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>${springdoc.version}</version>
        </dependency>

        <!-- OpenAPI Generator Runtime -->
        <dependency>
            <groupId>org.openapitools</groupId>
            <artifactId>jackson-databind-nullable</artifactId>
            <version>${jjwt-api.version}</version>
        </dependency>

        <!-- JEXL for dynamic price calculation formulas -->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-jexl3</artifactId>
            <version>${spring-security-test.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <!-- Testing -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
            <exclusions>
                <!-- Disable JUnit Vintage (JUnit 4) to avoid conflicts with JUnit 5 -->
                <exclusion>
                    <groupId>org.junit.vintage</groupId>
                    <artifactId>junit-vintage-engine</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-test</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.testcontainers</groupId>
            <artifactId>junit-jupiter</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.testcontainers</groupId>
            <artifactId>postgresql</artifactId>
            <scope>test</scope>
        </dependency>

        <!-- In-memory DB for tests to avoid external PostgreSQL/Liquibase -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>test</scope>
        </dependency>


        <!-- Live reload for development -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>
    </dependencies>
    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
                <includes>
                    <include>application*.yml</include>
                    <include>application*.properties</include>
                </includes>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>false</filtering>
                <excludes>
                    <exclude>application*.yml</exclude>
                    <exclude>application*.properties</exclude>
                </excludes>
            </resource>
        </resources>

        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <mainClass>com.aksi.DryCleaningOrderSystemApplication</mainClass>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <release>21</release>
                    <compilerArgs>
                        <arg>-Xlint:unchecked</arg>
                        <arg>-Xlint:deprecation</arg>
                    </compilerArgs>
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                            <version>${lombok.version}</version>
                        </path>
                        <path>
                            <groupId>org.mapstruct</groupId>
                            <artifactId>mapstruct-processor</artifactId>
                            <version>${mapstruct.version}</version>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>

            <plugin>
                <groupId>org.liquibase</groupId>
                <artifactId>liquibase-maven-plugin</artifactId>
                <configuration>
                    <propertyFile>src/main/resources/liquibase.properties</propertyFile>
                    <changeLogFile>src/main/resources/db/changelog/db.changelog-master.yaml</changeLogFile>
                </configuration>
            </plugin>

            <!-- Build Helper for adding generated-sources to IDE -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>add-generated-source</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>add-source</goal>
                        </goals>
                        <configuration>
                            <sources>
                                <source>${project.build.directory}/generated-sources/openapi/src/main/java</source>
                            </sources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!-- Maven Versions Plugin for dependency updates -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>versions-maven-plugin</artifactId>
                <version>${maven-versions-plugin.version}</version>
                <configuration>
                    <!-- Exclude snapshots and release candidates -->
                    <allowSnapshots>false</allowSnapshots>
                    <allowIncrementalUpdates>true</allowIncrementalUpdates>
                    <allowMajorUpdates>false</allowMajorUpdates>
                    <allowMinorUpdates>true</allowMinorUpdates>
                    <!-- Generate backup files -->
                    <generateBackupPoms>true</generateBackupPoms>
                </configuration>
            </plugin>

            <!-- OpenAPI Generator for DTO and controller generation -->
            <plugin>
                <groupId>org.openapitools</groupId>
                <artifactId>openapi-generator-maven-plugin</artifactId>
                <version>${openapi-generator-maven-plugin.version}</version>
                <configuration>
                    <!-- Disable post-processing - using Spotless instead -->
                    <enablePostProcessFile>false</enablePostProcessFile>
                    <!-- Глобальне кастомне мапування типів для всіх API -->
                    <typeMappings>
                        <typeMapping>OffsetDateTime=Instant</typeMapping>
                        <typeMapping>LocalDateTime=Instant</typeMapping>
                    </typeMappings>
                    <importMappings>
                        <importMapping>Instant=java.time.Instant</importMapping>
                        <importMapping>OffsetDateTime=java.time.Instant</importMapping>
                        <importMapping>LocalDateTime=java.time.Instant</importMapping>
                        <importMapping>Integer=java.lang.Integer</importMapping>
                    </importMappings>
                </configuration>
                <executions>
                    <!-- Generate Auth API -->
                    <execution>
                        <id>generate-auth-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/auth/auth-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.auth</apiPackage>
                            <modelPackage>com.aksi.api.auth.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Cart API -->
                    <execution>
                        <id>generate-cart-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/cart/cart-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.cart</apiPackage>
                            <modelPackage>com.aksi.api.cart.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Game API -->
                    <execution>
                        <id>generate-game-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/games/games-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.game</apiPackage>
                            <modelPackage>com.aksi.api.game.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Branch API -->
                    <execution>
                        <id>generate-branch-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/branch/branch-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.branch</apiPackage>
                            <modelPackage>com.aksi.api.branch.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate User API -->
                    <execution>
                        <id>generate-user-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/user/user-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.user</apiPackage>
                            <modelPackage>com.aksi.api.user.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Customer API -->
                    <execution>
                        <id>generate-customer-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/customer/customer-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.customer</apiPackage>
                            <modelPackage>com.aksi.api.customer.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Order API -->
                    <execution>
                        <id>generate-order-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/order/order-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.order</apiPackage>
                            <modelPackage>com.aksi.api.order.dto</modelPackage>
                            <modelNameMappings>
                                <modelNameMapping>ItemModifier=OrderItemModifier</modelNameMapping>
                                <modelNameMapping>ModifierDetail=OrderModifierDetail</modelNameMapping>
                            </modelNameMappings>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Pricing API -->
                    <execution>
                        <id>generate-pricing-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/pricing/pricing-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.pricing</apiPackage>
                            <modelPackage>com.aksi.api.pricing.dto</modelPackage>
                            <modelNameMappings>
                                <modelNameMapping>ItemCharacteristics=PricingItemCharacteristics</modelNameMapping>
                            </modelNameMappings>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Price List API -->
                    <execution>
                        <id>generate-price-list-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/price-list/price-list-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.pricelist</apiPackage>
                            <modelPackage>com.aksi.api.pricelist.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate Receipt API -->
                    <execution>
                        <id>generate-receipt-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/receipt/receipt-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.receipt</apiPackage>
                            <modelPackage>com.aksi.api.receipt.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                    <!-- Generate File API -->
                    <execution>
                        <id>generate-file-api</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <inputSpec>${project.basedir}/src/main/resources/openapi/file/file-api.yaml</inputSpec>
                            <generatorName>spring</generatorName>
                            <apiPackage>com.aksi.api.file</apiPackage>
                            <modelPackage>com.aksi.api.file.dto</modelPackage>
                            <configOptions>
                                <interfaceOnly>true</interfaceOnly>
                                <useTags>true</useTags>
                                <dateLibrary>java8</dateLibrary>
                                <java8>true</java8>
                                <useSpringBoot3>true</useSpringBoot3>
                                <useBeanValidation>true</useBeanValidation>
                                <performBeanValidation>true</performBeanValidation>
                                <serializableModel>true</serializableModel>
                                <delegatePattern>false</delegatePattern>
                                <skipDefaultInterface>false</skipDefaultInterface>
                                <resolveFully>true</resolveFully>
                                <generateExamples>false</generateExamples>
                                <generateModelDocumentation>false</generateModelDocumentation>
                            </configOptions>
                        </configuration>
                    </execution>

                </executions>
            </plugin>

            <!-- Spotless - automatic code formatting -->
            <plugin>
                <groupId>com.diffplug.spotless</groupId>
                <artifactId>spotless-maven-plugin</artifactId>
                <version>${spotless-maven-plugin.version}</version>
                <configuration>
                    <!-- Enable up-to-date checking with proper index location -->
                    <upToDateChecking>
                        <enabled>true</enabled>
                        <indexFile>${project.build.directory}/spotless-index</indexFile>
                    </upToDateChecking>
                    <!-- Optimize performance for large projects -->
                    <formats>
                        <format>
                            <includes>
                                <include>**/*.java</include>
                            </includes>
                        </format>
                    </formats>
                    <java>
                        <!-- Include all project Java files + generated OpenAPI -->
                        <includes>
                            <include>src/main/java/**/*.java</include>
                            <include>src/test/java/**/*.java</include>
                            <include>target/generated-sources/openapi/**/*.java</include>
                        </includes>
                        <!-- Google Java Format -->
                        <googleJavaFormat>
                            <version>${google-java-format.version}</version>
                            <style>GOOGLE</style>
                        </googleJavaFormat>
                        <!-- Import order (must be BEFORE removeUnusedImports) -->
                        <importOrder>
                            <order>java|javax,org,com,com.aksi</order>
                        </importOrder>
                        <!-- Remove unused imports -->
                        <removeUnusedImports>
                            <engine>google-java-format</engine>
                        </removeUnusedImports>
                        <!-- Whitespace cleanup -->
                        <trimTrailingWhitespace/>
                        <endWithNewline/>
                    </java>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>apply</goal>
                        </goals>
                        <!-- Run after OpenAPI generation -->
                        <phase>process-sources</phase>
                    </execution>
                </executions>
            </plugin>

            <!-- PMD for code duplication detection (CPD) -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-pmd-plugin</artifactId>
                <version>${maven-pmd-plugin.version}</version>
                <configuration>
                    <minimumTokens>30</minimumTokens>
                    <skipEmptyReport>false</skipEmptyReport>
                    <analysisCache>true</analysisCache>
                    <printFailingErrors>true</printFailingErrors>
                    <linkXRef>false</linkXRef>
                    <failOnViolation>false</failOnViolation>
                    <!-- Exclude controllers from CPD -->
                    <excludes>
                        <exclude>**/api/**/*Controller.java</exclude>
                        <exclude>**/util/ApiResponseUtils.java</exclude>
                        <exclude>**/target/**/*</exclude>
                        <exclude>target/**</exclude>
                        <exclude>**/generated-sources/**</exclude>
                    </excludes>
                </configuration>
                <executions>
                    <execution>
                        <id>cpd-check</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>cpd-check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <!-- Checkstyle for code style checking + unused imports -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-checkstyle-plugin</artifactId>
                <version>${maven-checkstyle-plugin.version}</version>
                <configuration>
                    <configLocation>checkstyle.xml</configLocation>
                    <suppressionsLocation>checkstyle-suppressions.xml</suppressionsLocation>
                    <includeTestSourceDirectory>true</includeTestSourceDirectory>
                    <violationSeverity>warning</violationSeverity>
                    <consoleOutput>true</consoleOutput>
                    <logViolationsToConsole>true</logViolationsToConsole>
                    <failsOnError>false</failsOnError>
                    <maxAllowedViolations>2000</maxAllowedViolations>
                    <skip>false</skip>
                </configuration>
                <dependencies>
                    <dependency>
                        <groupId>com.puppycrawl.tools</groupId>
                        <artifactId>checkstyle</artifactId>
                        <version>${checkstyle.version}</version>
                    </dependency>
                </dependencies>
                <executions>
                    <execution>
                        <id>checkstyle-check</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <!-- Profiles for build optimization -->
    <profiles>
        <!-- Fast development profile (WITHOUT blocking OpenAPI, but with spotless for generated files) -->
        <profile>
            <id>dev-fast</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <!-- Skip tests for fast build -->
                <skipTests>true</skipTests>
                <maven.test.skip>true</maven.test.skip>
                <!-- Skip checkstyle -->
                <checkstyle.skip>true</checkstyle.skip>
                <!-- Skip PMD and CPD -->
                <pmd.skip>true</pmd.skip>
                <cpd.skip>true</cpd.skip>
                <!-- Keep spotless for OpenAPI files -->
                <spotless.skip>false</spotless.skip>
            </properties>
        </profile>

        <!-- Separate profile for dev WITHOUT OpenAPI (if needed) -->
        <profile>
            <id>dev-no-api</id>
            <properties>
                <skipTests>true</skipTests>
                <maven.test.skip>true</maven.test.skip>
                <checkstyle.skip>true</checkstyle.skip>
                <pmd.skip>true</pmd.skip>
                <cpd.skip>true</cpd.skip>
                <spotless.skip>true</spotless.skip>
            </properties>
            <build>
                <plugins>
                    <!-- Disable OpenAPI generation -->
                    <plugin>
                        <groupId>org.openapitools</groupId>
                        <artifactId>openapi-generator-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>generate-auth-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-user-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-customer-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-price-list-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-cart-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-branch-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-order-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-pricing-api</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>generate-receipt-api</id>
                                <phase>none</phase>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Full production build -->
        <profile>
            <id>full-build</id>
            <properties>
                <skipTests>false</skipTests>
                <checkstyle.skip>false</checkstyle.skip>
                <pmd.skip>false</pmd.skip>
                <cpd.skip>false</cpd.skip>
                <spotless.skip>false</spotless.skip>
            </properties>
        </profile>

        <!-- Separate OpenAPI generation -->
        <profile>
            <id>generate-api</id>
            <properties>
                <skipTests>true</skipTests>
            </properties>
        </profile>
    </profiles>
</project>
